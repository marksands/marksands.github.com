<!DOCTYPE html>
<html class="no-js">
  <head>
	<meta charset="utf-8">
	<title>Builder Pattern | Mark Sands</title>
	<meta name="description" content="The builder pattern is a creational design pattern. It is used to abstract steps of the construction of complex objects from its representation so that the s...">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-Frame-Options" content="sameorigin">

	<!-- CSS -->
	<link rel="stylesheet" href="/css/main.css">

	<!--Favicon-->
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

	<!-- Canonical -->
	<link rel="canonical" href="http://marksands.github.io/2013/05/31/builder-pattern.html">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="Mark Sands" href="http://marksands.github.io/feed.xml" />

	<!-- Font Awesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">
	

	<!-- KaTeX -->
	

	<!-- Google Analytics -->
	
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-41405801-1', 'auto');
	ga('send', 'pageview');
	</script>
	
</head>

  <body>
    <header class="site-header">
	<div class="branding">
		
		<a href="/">
			<img class="avatar" src="https://secure.gravatar.com/avatar/7a6e4cc366f8f533b056936cf9bcb85d?s=100" alt=""/>
		</a>
		
		<h1 class="site-title">
			<a href="/">Mark Sands</a>
		</h1>
	</div>
	<nav class="site-nav">
		<ul>
			
			
			
			
			<li>
				<a class="page-link" href="/about/">
					About
				</a>
			</li>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<!-- Social icons from Font Awesome, if enabled -->
			
<li>
	<a href="http://marksands.github.io/feed.xml" title="Follow RSS feed">
		<i class="fa fa-fw fa-rss"></i>
	</a>
</li>



<li>
	<a href="mailto:marksands07@gmail.com" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>













<li>
	<a href="https://github.com/marksands" title="Follow on GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>





















<li>
	<a href="https://twitter.com/marksands" title="Follow on Twitter">
		<i class="fa fa-fw fa-twitter"></i>
	</a>
</li>






		</ul>
	</nav>
</header>

    <div class="content">
      <article >
  <header style="background-image: url('/')">
    <h1 class="title">Builder Pattern</h1>
    <p class="meta">
    May 31, 2013
    
    </p>
  </header>
  <section class="post-content"><p>The builder pattern is a creational design pattern. It is used to abstract steps of the construction of complex objects from its representation so that the same construction process 
can create different representations.<a href="http://c2.com/cgi/wiki?DesignPatternsBook">ยน</a></p>

<p>Complex objects that the builder pattern can be useful towards, for example, include building mazes, characters in video games, and perhaps even baking. However, these examples are 
somewhat of a stretch and don&#39;t provide any common ground for beginners. One thing I&#39;ve found the builder pattern to be useful for is for building attributed labels.</p>

<!-- more -->

<p>Take, for example, Mattt Thompson&#39;s <a href="https://github.com/mattt/TTTAttributedLabel">TTTAttributedLabel</a>. It has some <a href="https://github.com/mattt/TTTAttributedLabel#example-usage">pretty ugly</a> 
sample code on how to set the attributed text, which is enough to scare anyone away from attributed strings. Fortunately, this can be improved. One way to improve this is by extending 
<code>NSAttributedString</code> to use the builder pattern.</p>
<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="n">NSAttributedString</span> <span class="o">*</span><span class="n">string</span> <span class="o">=</span>  <span class="p">[[[[[[</span><span class="n">NSAttributedString</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithString</span><span class="p">:</span><span class="s">@"Hello World!"</span><span class="p">]</span>
                                 <span class="nf">addFont</span><span class="p">:[</span><span class="n">UIFont</span> <span class="nf">systemFontOfSize</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span> <span class="nf">string</span><span class="p">:</span><span class="s">@"Hello World!"</span><span class="p">]</span>
                                <span class="nf">addTextColor</span><span class="p">:[</span><span class="n">UIColor</span> <span class="nf">redColor</span><span class="p">]</span> <span class="nf">string</span><span class="p">:</span><span class="s">@"Hello World!"</span><span class="p">]</span>
                               <span class="nf">addFont</span><span class="p">:[</span><span class="n">UIFont</span> <span class="nf">systemFontOfSize</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="nf">string</span><span class="p">:</span><span class="s">@"Hello"</span><span class="p">]</span>
                              <span class="nf">addTextColor</span><span class="p">:[</span><span class="n">UIColor</span> <span class="nf">blueColor</span><span class="p">]</span> <span class="nf">string</span><span class="p">:</span><span class="s">@"World!"</span><span class="p">];</span>

<span class="n">TTTAttributedLabel</span> <span class="o">*</span><span class="n">attributedLabel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">TTTAttributedLabel</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
<span class="n">attributedLabel</span><span class="p">.</span><span class="n">attributedText</span> <span class="o">=</span> <span class="n">string</span><span class="p">;</span>
</code></pre></div>
<p>Here you can see the effects of the builder pattern in action, which is a much more attractive approach. And the implementation is trivial. 
Below is an NSAttributedString category with a stripped down version of the bigger picture.</p>
<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="k">@interface</span> <span class="nc">NSAttributedString</span> <span class="p">(</span><span class="nl">Builder</span><span class="p">)</span>

<span class="err">-</span> <span class="err">(</span><span class="nc">NSAttributedString</span> <span class="o">*</span><span class="p">)</span><span class="n">addAttributes</span><span class="o">:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="n">attributes</span> <span class="n">range</span><span class="o">:</span><span class="p">(</span><span class="n">NSRange</span><span class="p">)</span><span class="n">range</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSAttributedString</span> <span class="o">*</span><span class="p">)</span><span class="nf">addFont</span><span class="p">:(</span><span class="n">UIFont</span> <span class="o">*</span><span class="p">)</span><span class="nv">font</span> <span class="nf">string</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">string</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSAttributedString</span> <span class="o">*</span><span class="p">)</span><span class="nf">addTextColor</span><span class="p">:(</span><span class="n">UIColor</span> <span class="o">*</span><span class="p">)</span><span class="nv">color</span> <span class="nf">string</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">string</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">NSAttributedString</span> <span class="p">(</span><span class="nl">Builder</span><span class="p">)</span>

<span class="err">-</span> <span class="err">(</span><span class="nc">NSAttributedString</span> <span class="o">*</span><span class="p">)</span><span class="n">addAttributes</span><span class="o">:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="n">attributes</span>
                                <span class="n">range</span><span class="o">:</span><span class="p">(</span><span class="n">NSRange</span><span class="p">)</span><span class="n">range</span>
<span class="p">{</span>
    <span class="n">NSMutableAttributedString</span> <span class="o">*</span><span class="n">mutableString</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">mutableCopy</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">location</span> <span class="o">!=</span> <span class="n">NSNotFound</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="n">key</span> <span class="k">in</span> <span class="p">[</span><span class="n">attributes</span> <span class="nf">allKeys</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">id</span> <span class="n">value</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="nf">key</span><span class="p">];</span>
            <span class="p">[</span><span class="n">mutableString</span> <span class="nf">addAttribute</span><span class="p">:</span><span class="n">key</span> <span class="nf">value</span><span class="p">:</span><span class="n">value</span> <span class="nf">range</span><span class="p">:</span><span class="n">range</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">mutableString</span> <span class="nf">copy</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">NSAttributedString</span> <span class="o">*</span><span class="p">)</span><span class="n">addFont</span><span class="o">:</span><span class="p">(</span><span class="n">UIFont</span> <span class="o">*</span><span class="p">)</span><span class="n">font</span> <span class="n">string</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">string</span>
<span class="p">{</span>
    <span class="n">NSRange</span> <span class="n">range</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="nf">string</span><span class="p">]</span> <span class="nf">rangeOfString</span><span class="p">:</span><span class="n">string</span><span class="p">];</span>

    <span class="n">CTFontRef</span> <span class="n">ctfont</span> <span class="o">=</span> <span class="n">CTFontCreateWithName</span><span class="p">((</span><span class="n">__bridge</span> <span class="n">CFStringRef</span><span class="p">)</span><span class="n">font</span><span class="p">.</span><span class="n">fontName</span><span class="p">,</span> <span class="n">font</span><span class="p">.</span><span class="n">pointSize</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDictionary</span> <span class="nf">dictionaryWithObject</span><span class="p">:(</span><span class="n">__bridge</span> <span class="n">id</span><span class="p">)(</span><span class="n">ctfont</span><span class="p">)</span> <span class="nf">forKey</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">kCTFontAttributeName</span><span class="p">];</span>
    <span class="n">CFRelease</span><span class="p">(</span><span class="n">ctfont</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nf">addAttributes</span><span class="p">:</span><span class="n">attributes</span> <span class="nf">range</span><span class="p">:</span><span class="n">range</span><span class="p">];</span>
<span class="p">}</span>

<span class="o">-</span> <span class="p">(</span><span class="n">NSAttributedString</span> <span class="o">*</span><span class="p">)</span><span class="n">addTextColor</span><span class="o">:</span><span class="p">(</span><span class="n">UIColor</span> <span class="o">*</span><span class="p">)</span><span class="n">color</span> <span class="n">string</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">string</span>
<span class="p">{</span>
    <span class="n">NSRange</span> <span class="n">range</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="nf">string</span><span class="p">]</span> <span class="nf">rangeOfString</span><span class="p">:</span><span class="n">string</span><span class="p">];</span>
    <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDictionary</span> <span class="nf">dictionaryWithObject</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="n">color</span><span class="p">.</span><span class="n">CGColor</span> <span class="nf">forKey</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">kCTForegroundColorAttributeName</span><span class="p">];</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="nf">addAttributes</span><span class="p">:</span><span class="n">attributes</span> <span class="nf">range</span><span class="p">:</span><span class="n">range</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">@end</span>
</code></pre></div>
<p>And there you have it. Of course, you can do more than just modify the font and text color. You can see my full implementation on 
<a href="https://github.com/marksands/NSAttributedString-Builder">GitHub</a>. Please note, however, that this implementation is written specifically 
to work with TTTAttributedLabel. If you want support for attributed text on UILabel in iOS6, check out the <a href="https://github.com/marksands/NSAttributedString-Builder/tree/iOS6">iOS6 branch</a>.</p>

<h3 id="references">References</h3>

<ul>
<li><a href="http://c2.com/cgi/wiki?DesignPatternsBook">[1] Design Patterns: Elements of Reusable Object-Oriented Software</a></li>
</ul>
</section>
</article>

<!-- Post navigation -->

<div id="post-nav">
    
    <a id="prev-post" href="/2012/05/18/raii.html">
      <span class="page-title">RAII</span>
      <span class="nav-label">
        <i class="fa fa-chevron-left"></i> Prev
      </span>
    </a>
    
    
    <a id="next-post" href="/2013/06/24/trampolines-and-higher-order-messaging.html">
       <span class="page-title">Trampolines & Higher Order Messaging</span>
       <span class="nav-label">
        Next <i class="fa fa-chevron-right"></i>
       </span>
     </a>
    
</div>


<!-- Disqus -->

<div class="comments">
  <div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_shortname = 'marksandsgithub';
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>


    </div>
    


<footer class="site-footer">
	<p class="text">Powered by <a href="http://jekyllrb.com">Jekyll</a>
</p>
</footer>


  </body>
</html>
