<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Builder Pattern</title>
        <meta name="viewport" content="width=device-width">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css">

    </head>
    <body>

      <div id="page" class="hentry">
        
        <header class="the-header">
          <div class="unit-head">
            <div class="unit-inner unit-head-inner">
              <p class="logo"><a href=""></a></p>
              <nav class="nav-global">
                <ul>
                  <li class="github"><a href="http://github.com/marksands">github</a></li>
                  <li class="twitter"><a href="http://twitter.com/marksands">twitter</a></li>
                </ul>
              </nav>
            </div><!-- unit-inner -->
          </div><!-- unit-head -->
        </header>
        
        <div class="body" role="main">
          
          <!-- begin ads -->
          <article class="unit-article layout-page">
            <div class="unit-inner unit-article-inner">
              <div class="content">
                <div class="bd">
                  <div class="entry-content">
                    <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                    <ins class="adsbygoogle"
                         style="display:inline-block;width:728px;height:90px"
                         data-ad-client="ca-pub-5267577598224051"
                         data-ad-slot="1897609812"></ins>
                    <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                  </div>
                </div>
              </div>
            </div>
          </article>
          <!-- end ads -->
          
          <div class="unit-body">
            <div class="unit-inner unit-body-inner">
              <div class="entry-content">
                <article class="unit-article layout-post">
  <div class="unit-inner unit-article-inner">
    <div class="content">
      <header>
        <div class="unit-head">
          <div class="unit-inner unit-head-inner">
            <!-- <h1 class="h2 entry-title">Builder Pattern</h1> -->
            
          </div><!-- unit-inner -->
        </div><!-- unit-head -->
      </header>

      <div class="bd">
        <div class="entry-content">
          <h1>Builder Pattern</h1>
          <p>The builder pattern is a creational design pattern. It is used to abstract steps of the construction of complex objects from its representation so that the same construction process 
can create different representations.<a href="http://c2.com/cgi/wiki?DesignPatternsBook">ยน</a></p>

<p>Complex objects that the builder pattern can be useful towards, for example, include building mazes, characters in video games, and perhaps even baking. However, these examples are 
somewhat of a stretch and don&#39;t provide any common ground for beginners. One thing I&#39;ve found the builder pattern to be useful for is for building attributed labels.</p>

<p>Take, for example, Mattt Thompson&#39;s <a href="https://github.com/mattt/TTTAttributedLabel">TTTAttributedLabel</a>. It has some <a href="https://github.com/mattt/TTTAttributedLabel#example-usage">pretty ugly</a> 
sample code on how to set the attributed text, which is enough to scare anyone away from attributed strings. Fortunately, this can be improved. One way to improve this is by extending 
<code>NSAttributedString</code> to use the builder pattern.</p>

<div class="highlight"><pre><code class="objective-c"><span class="lineno">1</span> <span class="n">NSAttributedString</span> <span class="o">*</span><span class="n">string</span> <span class="o">=</span>  <span class="p">[[[[[[</span><span class="n">NSAttributedString</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">initWithString</span><span class="o">:</span><span class="s">@&quot;Hello World!&quot;</span><span class="p">]</span>
<span class="lineno">2</span>                                  <span class="nl">addFont:</span><span class="p">[</span><span class="n">UIFont</span> <span class="n">systemFontOfSize</span><span class="o">:</span><span class="mi">18</span><span class="p">]</span> <span class="n">string</span><span class="o">:</span><span class="s">@&quot;Hello World!&quot;</span><span class="p">]</span>
<span class="lineno">3</span>                                 <span class="nl">addTextColor:</span><span class="p">[</span><span class="n">UIColor</span> <span class="n">redColor</span><span class="p">]</span> <span class="n">string</span><span class="o">:</span><span class="s">@&quot;Hello World!&quot;</span><span class="p">]</span>
<span class="lineno">4</span>                                <span class="nl">addFont:</span><span class="p">[</span><span class="n">UIFont</span> <span class="n">systemFontOfSize</span><span class="o">:</span><span class="mi">12</span><span class="p">]</span> <span class="n">string</span><span class="o">:</span><span class="s">@&quot;Hello&quot;</span><span class="p">]</span>
<span class="lineno">5</span>                               <span class="nl">addTextColor:</span><span class="p">[</span><span class="n">UIColor</span> <span class="n">blueColor</span><span class="p">]</span> <span class="n">string</span><span class="o">:</span><span class="s">@&quot;World!&quot;</span><span class="p">];</span>
<span class="lineno">6</span>                               
<span class="lineno">7</span> <span class="n">TTTAttributedLabel</span> <span class="o">*</span><span class="n">attributedLabel</span> <span class="o">=</span> <span class="p">[[</span><span class="n">TTTAttributedLabel</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
<span class="lineno">8</span> <span class="n">attributedLabel</span><span class="p">.</span><span class="n">attributedText</span> <span class="o">=</span> <span class="n">string</span><span class="p">;</span>
</code></pre></div>

<p>Here you can see the effects of the builder pattern in action, which is a much more attractive approach. And the implementation is trivial. 
Below is an NSAttributedString category with a stripped down version of the bigger picture.</p>

<div class="highlight"><pre><code class="objective-c"><span class="lineno"> 1</span> <span class="k">@interface</span> <span class="nc">NSAttributedString</span> <span class="nl">(Builder)</span>
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="k">-</span> <span class="p">(</span><span class="n">NSAttributedString</span> <span class="o">*</span><span class="p">)</span><span class="nf">addAttributes:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">attributes</span> <span class="nf">range:</span><span class="p">(</span><span class="n">NSRange</span><span class="p">)</span><span class="nv">range</span><span class="p">;</span>
<span class="lineno"> 4</span> <span class="k">-</span> <span class="p">(</span><span class="n">NSAttributedString</span> <span class="o">*</span><span class="p">)</span><span class="nf">addFont:</span><span class="p">(</span><span class="n">UIFont</span> <span class="o">*</span><span class="p">)</span><span class="nv">font</span> <span class="nf">string:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">string</span><span class="p">;</span>
<span class="lineno"> 5</span> <span class="k">-</span> <span class="p">(</span><span class="n">NSAttributedString</span> <span class="o">*</span><span class="p">)</span><span class="nf">addTextColor:</span><span class="p">(</span><span class="n">UIColor</span> <span class="o">*</span><span class="p">)</span><span class="nv">color</span> <span class="nf">string:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">string</span><span class="p">;</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span> <span class="k">@end</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span> <span class="k">@implementation</span> <span class="nc">NSAttributedString</span> <span class="nl">(Builder)</span>
<span class="lineno">10</span> 
<span class="lineno">11</span> <span class="k">-</span> <span class="p">(</span><span class="n">NSAttributedString</span> <span class="o">*</span><span class="p">)</span><span class="nf">addAttributes:</span><span class="p">(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">attributes</span>
<span class="lineno">12</span>                                 <span class="nl">range:</span><span class="p">(</span><span class="n">NSRange</span><span class="p">)</span><span class="nv">range</span>
<span class="lineno">13</span> <span class="p">{</span>
<span class="lineno">14</span>     <span class="n">NSMutableAttributedString</span> <span class="o">*</span><span class="n">mutableString</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="n">mutableCopy</span><span class="p">];</span>
<span class="lineno">15</span>     
<span class="lineno">16</span>     <span class="k">if</span> <span class="p">(</span><span class="n">range</span><span class="p">.</span><span class="n">location</span> <span class="o">!=</span> <span class="n">NSNotFound</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">17</span>         <span class="k">for</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="n">key</span> <span class="k">in</span> <span class="p">[</span><span class="n">attributes</span> <span class="n">allKeys</span><span class="p">])</span> <span class="p">{</span>
<span class="lineno">18</span>             <span class="kt">id</span> <span class="n">value</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">];</span>
<span class="lineno">19</span>             <span class="p">[</span><span class="n">mutableString</span> <span class="n">addAttribute</span><span class="o">:</span><span class="n">key</span> <span class="n">value</span><span class="o">:</span><span class="n">value</span> <span class="n">range</span><span class="o">:</span><span class="n">range</span><span class="p">];</span>
<span class="lineno">20</span>         <span class="p">}</span>
<span class="lineno">21</span>     <span class="p">}</span>
<span class="lineno">22</span>     
<span class="lineno">23</span>     <span class="k">return</span> <span class="p">[</span><span class="n">mutableString</span> <span class="n">copy</span><span class="p">];</span>
<span class="lineno">24</span> <span class="p">}</span>
<span class="lineno">25</span> 
<span class="lineno">26</span> <span class="k">-</span> <span class="p">(</span><span class="n">NSAttributedString</span> <span class="o">*</span><span class="p">)</span><span class="nf">addFont:</span><span class="p">(</span><span class="n">UIFont</span> <span class="o">*</span><span class="p">)</span><span class="nv">font</span> <span class="nf">string:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">string</span>
<span class="lineno">27</span> <span class="p">{</span>
<span class="lineno">28</span>     <span class="n">NSRange</span> <span class="n">range</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="n">string</span><span class="p">]</span> <span class="n">rangeOfString</span><span class="o">:</span><span class="n">string</span><span class="p">];</span>
<span class="lineno">29</span>     
<span class="lineno">30</span>     <span class="n">CTFontRef</span> <span class="n">ctfont</span> <span class="o">=</span> <span class="n">CTFontCreateWithName</span><span class="p">((</span><span class="n">__bridge</span> <span class="n">CFStringRef</span><span class="p">)</span><span class="n">font</span><span class="p">.</span><span class="n">fontName</span><span class="p">,</span> <span class="n">font</span><span class="p">.</span><span class="n">pointSize</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="lineno">31</span>     <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDictionary</span> <span class="n">dictionaryWithObject</span><span class="o">:</span><span class="p">(</span><span class="n">__bridge</span> <span class="kt">id</span><span class="p">)(</span><span class="n">ctfont</span><span class="p">)</span> <span class="n">forKey</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">kCTFontAttributeName</span><span class="p">];</span>
<span class="lineno">32</span>     <span class="n">CFRelease</span><span class="p">(</span><span class="n">ctfont</span><span class="p">);</span>
<span class="lineno">33</span>     
<span class="lineno">34</span>     <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="n">addAttributes</span><span class="o">:</span><span class="n">attributes</span> <span class="n">range</span><span class="o">:</span><span class="n">range</span><span class="p">];</span>
<span class="lineno">35</span> <span class="p">}</span>
<span class="lineno">36</span> 
<span class="lineno">37</span> <span class="k">-</span> <span class="p">(</span><span class="n">NSAttributedString</span> <span class="o">*</span><span class="p">)</span><span class="nf">addTextColor:</span><span class="p">(</span><span class="n">UIColor</span> <span class="o">*</span><span class="p">)</span><span class="nv">color</span> <span class="nf">string:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">string</span>
<span class="lineno">38</span> <span class="p">{</span>
<span class="lineno">39</span>     <span class="n">NSRange</span> <span class="n">range</span> <span class="o">=</span> <span class="p">[[</span><span class="n">self</span> <span class="n">string</span><span class="p">]</span> <span class="n">rangeOfString</span><span class="o">:</span><span class="n">string</span><span class="p">];</span>
<span class="lineno">40</span>     <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDictionary</span> <span class="n">dictionaryWithObject</span><span class="o">:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="n">color</span><span class="p">.</span><span class="n">CGColor</span> <span class="n">forKey</span><span class="o">:</span><span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">kCTForegroundColorAttributeName</span><span class="p">];</span>
<span class="lineno">41</span>     <span class="k">return</span> <span class="p">[</span><span class="n">self</span> <span class="n">addAttributes</span><span class="o">:</span><span class="n">attributes</span> <span class="n">range</span><span class="o">:</span><span class="n">range</span><span class="p">];</span>
<span class="lineno">42</span> <span class="p">}</span>
<span class="lineno">43</span> 
<span class="lineno">44</span> <span class="k">@end</span>
</code></pre></div>

<p>And there you have it. Of course, you can do more than just modify the font and text color. You can see my full implementation on 
<a href="https://github.com/marksands/NSAttributedString-Builder">GitHub</a>. Please note, however, that this implementation is written specifically 
to work with TTTAttributedLabel. If you want support for attributed text on UILabel in iOS6, check out the <a href="https://github.com/marksands/NSAttributedString-Builder/tree/iOS6">iOS6 branch</a>.</p>

<h3>References</h3>

<ul>
<li><a href="http://c2.com/cgi/wiki?DesignPatternsBook">[1] Design Patterns: Elements of Reusable Object-Oriented Software</a></li>
</ul>

          <div class="meta">
            <p class="date-publish">
              Published:
              <date class="date-pub" title="2013-05-31T00:00:00-05:00" datetime="2013-05-31T00:00:00-05:00" pubdate>
              <span class="month"><abbr>May</abbr></span>
              <span class="day">31</span>
              <span class="year">2013</span>
              </date>
            </p>
          </div><!-- meta -->
          
          <div class="comments">
            
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'marksandsgithub'; // required: replace example with your forum shortname

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            
          </div><!-- comments -->
        </div><!-- entry-content -->
      </div><!-- bd -->
      <footer class="unit-foot">
        <div class="unit-inner unit-foot-inner">
          <nav class="pagination">
            <ul>
              
              <li class="prev"><a class="internal" rel="prev"  href="/2012/05/18/raii.html" title="View RAII">&laquo; RAII</a></li>
              
              
              <li class="pipe"> | </li>
              
              
              <li class="next"><a class="internal" rel="next"  href="/2013/06/24/trampolines-and-higher-order-messaging.html" title="View Trampolines & Higher Order Messaging">Trampolines & Higher Order Messaging &raquo;</a></li>
              
            </ul>
          </nav>
      </footer>

    </div><!-- content -->
  </div><!-- unit-inner -->
</article>

              </div>
            </div><!-- unit-inner -->
          </div><!-- unit-body -->
        </div><!-- body -->

      </div><!-- page -->

      <script>
          /*! A fix for the iOS orientationchange zoom bug.Script by @scottjehl, rebound by @wilto. MIT License.*/
          (function(j){var i=j.document;if(!i.querySelectorAll){return}var l=i.querySelectorAll("meta[name=viewport]")[0],a=l&&l.getAttribute("content"),h=a+", maximum-scale=1.0",d=a+", maximum-scale=10.0",g=true,c=j.orientation,k=0;if(!l){return}function f(){l.setAttribute("content",d);g=true}function b(){l.setAttribute("content",h);g=false}function e(m){c=Math.abs(j.orientation);k=Math.abs(m.gamma);if(k>8&&c===0){if(g){b()}}else{if(!g){f()}}}j.addEventListener("orientationchange",f,false);j.addEventListener("deviceorientation",e,false)})(this);
      </script>
      
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-41405801-1', 'marksands.github.io');
        ga('send', 'pageview');
      </script>

    </body>
</html>
